# 云原生虚拟机配置

> 老师给的压缩包里有ISO：Centos原生镜像；Ovf：已经预安装了docker和k8s，系统为Cenos系统的开放虚拟化文件，可以直接通过Vmware打开，我们使用这个。如果通过ISO创建虚拟机的话docker和k8s都需要我们手动安装。
>
> 由于有很多命令都是粘贴复制比较方便，因此安装vmware-tools会舒服很多，但老师给的ovf包里是没有perl就无法正常安装vmware-tools，因此需要下载安装perl（后经测试发现vmware-tools效果不好）。但由于组建集群需要采用NAT模式（VM Net 8 适合在本机或者服务器上搭建多台虚拟机，组建局域网使用），因此第一步需要根据VMNet8来配置网卡信息
>
> 默认账号密码为: root, 123456

1. 配置网络

   `vi /etc/sysconfig/network-scripts/ifcfg-ens33`按照vmnet8的虚拟网卡信息配置虚拟机的参数，设置**IP地址**和**网关地址**以及**DNS1**(DNS1保持与网关地址一致)： 参数说明见[VMWare VMNet 8 的配置使用](https://www.cnblogs.com/hell8088/p/vmware.html)。查看Vmware菜单栏“编辑”->虚拟网络编辑器->NAT设置->网关IP后，我的配置如下

   ![网络配置](./网络配置.png)

2. 修改hostname: `hostnamectl set-hostname <new_hostname>`

3. 按照老师教程中步骤完成即可

## 实现将windows宿主机中文本内容复制到虚拟机中执行：

### 一. 使用xshell等SSH工具（推荐）

### 二. 使用vmware-tools（不推荐）

2. 换yum源

   ```shell
   # 1.进入yum源配置目录： 
   $ cd /etc/yum.repos.d
   # 2.下载阿里镜像源中的yum
   $ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
   # 3.生效
   $ yum makecache
   ```

3. 安装vmware-tools——VMware Workstation 下安装CentOS 以及tools

   > 换源是为了安装perl，因为在尝试安装vmware-tools时提示无法执行pl文件，即没有安装perl==> `yum install perl -y`

   1. vmware软件菜单栏"虚拟机->安装vmware-tools"

   2. 创建/mnt/cdrom 目录 挂载cdrom 将cdrom 中的内容复制到/opt/下

      ```
      mkdir /mnt/cdrom
      mount -o loop /dev/cdrom /mnt/cdrom
      cp -r /mnt/cdrom /opt/
      ```

   3. 查看/opt/cdrom目录下的内容，解压 VMware Tools: `tar -zxf VMwareTools-....tar.gz`

   4. 进入vmware tools解压出来的目录: `cd vmware-tools-distrib`

   5. 执行安装脚本: `./vmware-install.pl`，根据指令选择即可完成安装

   6. 修改完成之后，重新启动计算机，让 VMware Tools 生效： `shutdown -r now`

4. 安装gpm（这个主要适用于Linux系统内部上下文的复制粘贴）——[CentOS命令行版（tty1~6） 安装VMtools后无法复制文字](https://blog.csdn.net/Acecai01/article/details/103439018?utm_term=centos7vmware%E4%B8%8D%E8%83%BD%E5%A4%8D%E5%88%B6&utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-2-103439018&spm=3001.4430)

   > 由于tty下没有显示光标，所以鼠标根本不起作用，因此就算装vm工具都不太可能复制粘贴。但是，这里有个在无桌面版的虚拟机内部显示光标，实现虚拟机内部（不是跨宿主机和虚拟机的）复制粘贴功能的办法如下（适用centos7）：安装gpm

   1. 安装gpm: `yum install gpm*  `
   2. 启动gpm服务：`service gpm start`
   3. 将服务添加到后台服务（设置开机启动）: `systemctl enable gpm.service`

5. windows复制粘贴到centos：[如何从Windows复制指令到本地VMware上的Linux](https://blog.csdn.net/DayDayUp_1234/article/details/92625870)

   在Windows系统下确认复制到内容后，打开虚拟机窗口，注意不要将输入指定到虚拟机，直接Ctrl+V粘贴成功后，再Ctrl+G进入Linux系统运行即可——打开vmware程序Ctrl+Alt（即光标退出centos）然后再Ctrl+V就能看见内容被复制到centos的命令行上了

# 附录：

## [网络配置三种模式对比（桥接模式，主机模式，网络地址转换）](https://cloud.tencent.com/developer/article/1184666)

**bridged(桥接模式)**

在这种模式下，VMWare虚拟出来的操作系统就像是局域网中的一台**独立的主机**，它<u>可以访问网内任何一台机器</u>。 

在桥接模式下，你需要手工为虚拟系统配置IP地址、子网掩码，而且还要**和[宿主机](https://cloud.tencent.com/product/cdh?from=10680)器处于同一网段**，这样虚拟系统才能和宿主机器进行通信。同时，由 于这个虚拟系统是局域网中的一个独立的主机系统，那么就可以手工配置它的TCP/IP配置信息，以实现通过局域网的网关或路由器访问互联网。 　　

使用桥接模式的虚拟系统和宿主机器的关系，就像连接在同一个Hub上的两台电脑。想让它们相互通讯，你就需要为虚拟系统配置IP地址和子网掩码，否则就无法通信。

**工作的虚拟网卡**：bridged模式下的VMnet0虚拟网络

**host-only(主机模式)**

在某些特殊的网络调试环境中，要求将真实环境和虚拟环境隔离开，这时你就可采用host-only模式。在host-only模式中，所有的虚拟系统是可以相互通信的，但虚拟系统和真实的网络是被隔离开的。 　　

提示：在host-only模式下，虚拟系统和宿主机器系统是可以相互通信的，相当于这两台机器通过双绞线互连。 　

在host-only模式下，虚拟系统的TCP/IP配置信息(如IP地址、网关地址、DNS服务器等)，都是由VMnet1(host-only)虚拟网络的DHCP服务器来动态分配的。 　　如果你想利用VMWare创建一个与网内其他机器相隔离的虚拟系统，进行某些特殊的网络调试工作，可以选择host-only模式。

**工作的虚拟网卡**:host-only模式下的 VMnet1虚拟网络

**NAT(网络地址转换模式)**

使用NAT模式，就是让虚拟系统借助NAT(网络地址转换)功能，通过宿主机器所在的网络来访问公网。也就是说，使用NAT模式可以实现在虚拟 系统里访问互联网。NAT模式下的虚拟系统的TCP/IP配置信息是由VMnet8(NAT)虚拟网络的DHCP服务器提供的，无法进行手工修改，因此虚拟系统也就无法和本局域网中的其他真实主机进行通讯。采用NAT模式最大的优势是虚拟系统接入互联网非常简单，你不需要进行任何其他的配置，只需要宿主机 器能访问互联网即可。